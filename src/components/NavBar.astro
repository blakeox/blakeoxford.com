---
/**
 * NavBar.astro
 * Modern, accessible, and theme-aware navigation bar for the site.
 * - Semantic HTML, ARIA, and keyboard accessibility
 * - Responsive mobile/desktop layout
 * - Theme toggle and search overlay
 * - Hydrated by NavBarMenu.js for dynamic features
 * - Uses design tokens and utility classes for styling
 */
import ThemeToggle from './ThemeToggle';
import SearchOverlay from './SearchOverlay.astro';
import navLinks from '../config/navLinks.js';
---
<!-- Skip to main content for accessibility -->
<a href="#main-content" class="sr-only focus:not-sr-only absolute left-2 top-2 z-[1100] bg-accent text-background font-semibold px-4 py-2 rounded transition-colors duration-200">Skip to main content</a>
<nav class="navbar-container sticky top-0 z-[1000] transition-all duration-500 nav-visible" aria-label="Main Navigation" data-navbar>
  <style>
    /* Only keep advanced/dynamic/animation-specific styles here */
    .nav-link::before {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      width: 0;
      height: 2px;
      background: var(--gradient-accent);
      transition: all 0.3s var(--ease-emphasized);
      transform: translateX(-50%);
    }
    .nav-link:hover::before,
    .nav-link:focus::before,
    .nav-link[aria-current="page"]::before {
      width: 100%;
    }
    /* Hamburger menu animation */
    .hamburger-open .hamburger-line:nth-child(1) {
      transform: rotate(45deg) translate(6px, 6px);
    }
    .hamburger-open .hamburger-line:nth-child(2) {
      opacity: 0;
      transform: scaleX(0);
    }
    .hamburger-open .hamburger-line:nth-child(3) {
      transform: rotate(-45deg) translate(6px, -6px);
    }
    /* Page transition animations */
    .page-transition-enter {
      animation: fadeInScale 0.4s var(--ease-emphasized) forwards;
    }
    .page-transition-exit {
      animation: fadeOutScale 0.3s var(--ease-emphasized) forwards;
    }
    /* Enhanced focus styles */
    .nav-focus {
      outline: none;
      position: relative;
    }
    .nav-focus::after {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: var(--focus-ring-color);
      border-radius: inherit;
      opacity: 0;
      z-index: -1;
      transition: opacity 0.2s var(--ease-standard);
    }
    .nav-focus:focus::after {
      opacity: 0.2;
    }
    .pulse-glow {
      animation: pulseGlow 2s infinite;
    }
    .theme-light {
      --navbar-glow: 0 4px 20px rgba(0, 0, 0, 0.05);
    }
    .theme-dark {
      --navbar-glow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }
    .navbar-container.scrolled {
      box-shadow: var(--navbar-glow, var(--elevation-2));
    }
    .page-transition-exit .navbar-container {
      transform: translateY(-100%);
      transition: transform 0.3s var(--ease-emphasized);
    }
  </style>
  <div class="max-w-7xl mx-auto flex items-center justify-between px-4 py-2">
    <!-- Mobile Menu Toggle -->
    <button
      id="nav-toggle"
      type="button"
      class="nav-button text-navbar-text dark:text-navbar-textDark md:hidden p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-navbar-text dark:focus:ring-navbar-textDark transition-colors duration-200"
      aria-label="Toggle navigation"
      aria-expanded="false"
      aria-controls="nav-mobile-links"
    >
      <div class="hamburger-container w-6 h-6 flex flex-col justify-center items-center space-y-1">
        <span class="hamburger-line w-6 h-0.5 bg-current"></span>
        <span class="hamburger-line w-6 h-0.5 bg-current"></span>
        <span class="hamburger-line w-6 h-0.5 bg-current"></span>
      </div>
    </button>
    <!-- Brand/Logo -->
    <a class="navbar-logo flex items-center gap-2 font-heading text-xl text-navbar-text dark:text-navbar-textDark no-underline focus:outline-none focus:ring-2 focus:ring-navbar-text dark:focus:ring-navbar-textDark rounded transition-colors duration-200" href="/" aria-label="Blake Oxford Portfolio - Home">
      <span class="brand-avatar inline-flex items-center justify-center w-10 h-10 rounded-full font-heading text-lg mr-2 text-background dark:text-foreground transition-all duration-300">
        B
      </span>
      <span class="brand-text sr-only">Blake Oxford</span>
    </a>
    <!-- Desktop Navigation Links -->
    <ul class="hidden md:flex gap-6 items-center list-none m-0 p-0" id="nav-links" role="menubar">
      {navLinks.map(link => (
        <li role="none">
          <a class="nav-link" href={link.href} data-analytics={link.analytics} role="menuitem">{link.label}</a>
        </li>
      ))}
    </ul>
    <!-- Right Side Actions -->
    <div class="flex items-center gap-2">
      <button
        id="search-toggle"
        type="button"
        class="search-button nav-button text-navbar-text dark:text-navbar-textDark p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-navbar-text dark:focus:ring-navbar-textDark transition-all duration-200"
        aria-label="Open search"
        aria-keyshortcuts="/"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
      </button>
      <ThemeToggle client:load />
    </div>
  </div>
  <!-- Mobile Menu Overlay (click to close) -->
  <div class="mobile-menu-overlay fixed inset-0 bg-black/40 z-[1040] transition-opacity duration-200 md:hidden" tabindex="-1" aria-hidden="true" style="display:none;"></div>
  <!-- Mobile Navigation Menu -->
  <div class="mobile-menu md:hidden rounded-t-2xl shadow-2xl max-w-[95vw] mx-auto mt-2 open:opacity-100 open:translate-y-0" id="nav-mobile-links">
    <ul class="flex flex-col gap-3 px-4 pb-6 pt-2 list-none m-0" role="menu">
      {navLinks.map(link => (
        <li role="none" class="relative">
          <a class="nav-link block text-lg text-foreground font-medium hover:bg-accent/10 focus:bg-accent/20 transition-colors duration-200 py-3 px-4 rounded-xl focus:outline-none focus:ring-2 focus:ring-accent mobile-tap-effect {link.active ? 'active' : ''}" href={link.href} data-analytics={link.analytics} role="menuitem" aria-current={Astro.url.pathname === link.href ? 'page' : undefined}>
            {/* Active link indicator bar */}
            {Astro.url.pathname === link.href && (
              <span class="absolute left-0 top-2 bottom-2 w-1 rounded-full bg-accent"></span>
            )}
            {link.label}
          </a>
        </li>
      ))}
    </ul>
  </div>
  <!-- Scroll Progress Indicator -->
  <div class="scroll-progress" id="scroll-progress"></div>
  <!-- Only load the merged JS, now with defer for performance -->
  <script type="module" src="/assets/js/NavBarMenu.js" defer></script>
</nav>
<!-- Search Overlay -->
<SearchOverlay />
