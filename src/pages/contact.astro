---
import Layout from '../layouts/BaseLayout.astro';
import CoinFlipImage from '../components/CoinFlipImage.astro';
const title = "Contact Me";
const description = "Get in touch with Blake Oxford for collaboration, inquiries, or just to say hello!";
const canonicalUrl = "https://blakeoxford.com/contact/";
---

<Layout title={title} description={description} url={canonicalUrl} wide={true}>
  <!-- Hero section -->
  <section id="hero" class="py-24 md:py-36 bg-gradient-to-br from-background via-accent/5 to-background relative overflow-hidden">
    <div class="relative z-10 px-4">
      <div class="container mx-auto">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center">
          <div class="space-y-6">
            <h1 class="font-heading font-bold text-4xl md:text-5xl lg:text-6xl text-accent animate-fade-in">Let's Connect</h1>
            <p class="text-lead text-foreground-light dark:text-foreground animate-fade-in">Have a project in mind or just want to say hello? I'm all ears—whether it's a collaboration idea, a question, or just a quick chat. I usually reply within 24 hours and can't wait to build something great together!</p>
          </div>
          <div class="flex justify-center md:justify-end">
            <div class="relative">
              <CoinFlipImage frontSrc="/assets/images/Blake-O-scaled.jpg" backSrc="/assets/images/china-profile-picture.jpg" alt="Blake Oxford" size={260} flipMultipleTimes />
              <div class="absolute -top-4 -right-4 w-12 h-12 bg-accent rounded-full flex items-center justify-center text-background animate-float">💡</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Main contact section -->
  <section id="contact-info" class="c-contact-page w-full py-20 relative overflow-hidden bg-gradient-to-br from-background via-accent/5 to-background animate-fade-in" role="region" aria-labelledby="contact-title">
    <!-- Animated SVG background pattern -->
    <div class="absolute inset-0 z-0 opacity-20 pointer-events-none">
      <svg class="absolute inset-0 w-full h-full" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <pattern id="contact-grid" width="40" height="40" patternUnits="userSpaceOnUse">
            <path d="M0 40L40 0M20 40L40 20M0 20L20 0" fill="none" stroke="currentColor" stroke-width="1" stroke-opacity="0.12" />
          </pattern>
        </defs>
        <rect width="100%" height="100%" fill="url(#contact-grid)" />
      </svg>
    </div>
    <!-- Blurred/floating shapes -->
    <div class="absolute top-0 right-0 w-64 h-64 bg-accent/20 rounded-full blur-3xl translate-x-1/2 -translate-y-1/2 pointer-events-none"></div>
    <div class="absolute bottom-0 left-0 w-48 h-48 bg-accent/20 rounded-full blur-3xl -translate-x-1/2 translate-y-1/2 pointer-events-none"></div>

    <div class="relative z-10 px-4">
      <!-- Contact Information -->
      <div class="c-contact-page__info scroll-animate flex flex-col md:flex-row items-center justify-center gap-8 mb-16">
        <a href="mailto:blakepoxford@outlook.com" class="flex flex-col items-center gap-3 group focus:outline-none focus-visible:ring-2 focus-visible:ring-accent p-4 rounded-xl hover:bg-accent/5 transition-colors" aria-label="Email Blake Oxford" title="Email">
          <span class="text-accent text-3xl group-hover:scale-110 transition">✉️</span>
          <span class="font-medium text-primary group-hover:text-accent transition-colors">blakepoxford@outlook.com</span>
        </a>
        <a href="tel:2482024479" class="flex flex-col items-center gap-3 group focus:outline-none focus-visible:ring-2 focus-visible:ring-accent p-4 rounded-xl hover:bg-accent/5 transition-colors" aria-label="Call Blake Oxford" title="Phone">
          <span class="text-accent text-3xl group-hover:scale-110 transition">📞</span>
          <span class="font-medium text-primary group-hover:text-accent transition-colors">248-202-4479</span>
        </a>
        <a href="https://linkedin.com/in/blake-oxford" target="_blank" rel="noopener" class="flex flex-col items-center gap-3 group focus:outline-none focus-visible:ring-2 focus-visible:ring-accent p-4 rounded-xl hover:bg-accent/5 transition-colors" aria-label="LinkedIn" title="LinkedIn">
          <span class="text-accent text-3xl group-hover:scale-110 transition">💼</span>
          <span class="font-medium text-primary group-hover:text-accent transition-colors">linkedin.com/in/blake-oxford</span>
        </a>
      </div>

      <!-- Contact Form -->
      <div class="container mx-auto">
        <h2 id="message-form" class="font-heading font-bold text-3xl md:text-4xl text-accent text-center mb-8">Or Send Me a Message</h2>

        <!-- Form status banner -->
        <div id="form-status" aria-live="polite" class="hidden text-center font-semibold mb-4"></div>

        <div class="c-contact-page__form-container scroll-animate bg-surface dark:bg-surface-dark rounded-2xl shadow-xl p-8 mt-4 max-w-xl mx-auto border-2 border-accent/30 hover:border-accent/50 transition-colors">
          <form id="contact-form" method="POST" action="/send-email" class="space-y-6">
            <input type="hidden" name="form-name" value="contact" />
            <p class="hidden"><label>Don't fill this out: <input name="bot-field" /></label></p>

            <div class="flex flex-col gap-2">
              <label for="name" class="font-semibold text-lg">Name <span class="text-accent">*</span></label>
              <input
                id="name"
                name="name"
                autocomplete="name"
                required
                aria-required="true"
                class="w-full p-3 rounded-lg border-2 border-accent/30 focus:border-accent focus:ring-2 focus:ring-accent/20 dark:border-accent-dark dark:bg-surface-dark bg-surface transition-colors"
                placeholder="Your Name"
              />
            </div>
            <div class="flex flex-col gap-2">
              <label for="email" class="font-semibold text-lg">Email <span class="text-accent">*</span></label>
              <input
                id="email"
                name="email"
                type="email"
                autocomplete="email"
                required
                aria-required="true"
                class="w-full p-3 rounded-lg border-2 border-accent/30 focus:border-accent focus:ring-2 focus:ring-accent/20 dark:border-accent-dark dark:bg-surface-dark bg-surface transition-colors"
                placeholder="you@email.com"
              />
              <small class="text-sm text-neutral">I'll never share your email.</small>
            </div>
            <div class="flex flex-col gap-2">
              <label for="message" class="font-semibold text-lg">Message <span class="text-accent">*</span></label>
              <textarea
                id="message"
                name="message"
                rows="5"
                required
                aria-required="true"
                class="w-full p-3 rounded-lg border-2 border-accent/30 focus:border-accent focus:ring-2 focus:ring-accent/20 dark:border-accent-dark dark:bg-surface-dark bg-surface transition-colors"
                placeholder="How can I help you?"
              ></textarea>
            </div>

            <!-- Cloudflare Turnstile widget -->
            <div class="cf-turnstile" data-sitekey="0x4AAAAAABeu0PfX8oWvQvjR"></div>
            <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>

            <button type="submit" class="btn btn-primary mx-auto w-full md:w-auto">
              🚀 <span id="btn-label">Send Message</span>
              <svg id="spinner" class="hidden animate-spin h-5 w-5" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"/></svg>
            </button>
          </form>
        </div>
      </div>
    </div>
  </section>

  <!-- Confetti & JS -->
  <script is:inline>
    // Show banner if redirected with success
    if (new URLSearchParams(location.search).get('success') === 'true') {
      const s = document.getElementById('form-status');
      s.textContent = 'Thank you for your message! 🎉';
      s.classList.remove('hidden', 'text-red-600'); s.classList.add('text-green-600');
    }

    document.addEventListener('DOMContentLoaded', () => {
      const form   = document.getElementById('contact-form');
      const status = document.getElementById('form-status');
      const btn    = form.querySelector('button');
      const label  = document.getElementById('btn-label');
      const spinner= document.getElementById('spinner');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        status.classList.add('hidden');
        btn.disabled = true; label.textContent = 'Sending…'; spinner.classList.remove('hidden');

        const fd    = new FormData(form);
        if (fd.get('bot-field')) return;

        // Include Turnstile token here:
        const token = document.querySelector('[name="cf-turnstile-response"]')?.value || '';

        const payload = {
          name:    fd.get('name'),
          email:   fd.get('email'),
          message: fd.get('message'),
          token    // ← send the token
        };

        try {
          const res = await fetch('/send-email', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
          const json = await res.json();

          if (json.success) {
            status.textContent = 'Thank you for your message! 🎉';
            status.classList.remove('hidden', 'text-red-600'); status.classList.add('text-green-600');
            import('https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js')
              .then(mod => mod.default({ particleCount: 100, spread: 70, origin: { y: 0.6 } }));
            form.reset();
          } else {
            status.textContent = json.error || 'Something went wrong.';
            status.classList.remove('hidden'); status.classList.add('text-red-600');
          }
        } catch {
          status.textContent = 'Server error. Please try again later.';
          status.classList.remove('hidden'); status.classList.add('text-red-600');
        } finally {
          btn.disabled = false; label.textContent = 'Send Message'; spinner.classList.add('hidden');
        }
      });
    });
  </script>
</Layout>