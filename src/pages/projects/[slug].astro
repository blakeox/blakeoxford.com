---
import { getCollection, render } from 'astro:content';
import Layout from '../../layouts/BaseLayout.astro';

export async function getStaticPaths() {
  const projects = await getCollection('projects');
  return projects.map((project) => ({
    params: { slug: project.slug },
  }));
}

const { slug } = Astro.params;
const projects = await getCollection('projects');
const project = projects.find((p) => p.slug === slug);
if (!project) {
  throw new Error(`Project not found: ${slug}`);
}

// Compile the MDX/Markdown into a Content component
const { Content } = await render(project);

const { title, description, date, image, tags } = project.data;
const formattedDate = date.toLocaleDateString('en-US', {
  month: 'long',
  year: 'numeric',
});
const canonicalUrl = `https://blakeoxford.com/projects/${slug}/`;
---

<Layout
  title={title}
  description={description}
  image={image || '/assets/images/default-project.png'}
  url={canonicalUrl}
  wide={true}
>
  <!-- Project Hero Banner -->
  <section class="relative overflow-hidden py-16 md:py-24 bg-gradient-to-br from-background via-accent/5 to-background">
    <!-- … your existing hero SVG & markup … -->
  </section>

  <article class="c-project-detail px-4 md:px-12 lg:px-32 py-12">
    <!-- Breadcrumb Navigation -->
    <nav aria-label="Breadcrumb" class="breadcrumb text-sm mb-4">
      <a href="/" class="hover:underline">Home</a> /
      <a href="/projects/" class="hover:underline">Projects</a> /
      <span aria-current="page">{title}</span>
    </nav>

    <h2
      class="c-project-detail__title font-heading font-bold text-3xl md:text-4xl
             text-gradient bg-gradient-to-r from-accent-dark to-purple-600 mb-4"
    >
      Overview
    </h2>

    {description && <p class="c-project-detail__overview mb-4">{description}</p>}
    <p class="mb-4"><strong>Date:</strong> {formattedDate}</p>

    <!-- Render the compiled MDX/Markdown here -->
    <div class="prose prose-lg dark:prose-invert mb-8">
      <Content />
    </div>

    {tags && tags.length > 0 && (
      <div class="mb-8">
        <h3
          class="font-heading font-bold text-2xl text-gradient
                 bg-gradient-to-r from-accent-dark to-purple-600 mb-2"
        >
          Tags
        </h3>
        <ul class="c-tag-list list-inline mt-2">
          {tags.map((tag) => (
            <li class="c-tag-list__item inline-block mr-2">
              <a
                href={`/projects/?filter=${tag.toLowerCase().replace(/ /g, '-')}`}
                class="c-btn c-btn--secondary"
                aria-label={`Filter projects by ${tag}`}
              >
                {tag}
              </a>
            </li>
          ))}
        </ul>
      </div>
    )}

    <div class="c-project-detail__navigation text-center mt-8">
      <a href="/projects/" class="c-btn c-btn--secondary" aria-label="Back to Projects">
        Back to Projects
      </a>
    </div>
  </article>
</Layout>